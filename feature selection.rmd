---
title: "Example of classfier Selction for cancer detection"
output:
  html_document:
    fig_height: 4.5
    fig_width: 7.5
    theme: cosmo
    highlight: tango
    number_sections: true
    fig_caption: true
    toc: true
    code_folding: show
---

# Introduction

Early detection is key to the success treatment of cancers. Traditional methods most used for early detection have been regular and periodic self examination and annual or biannualdfr

check-ups analysis of tissue biopsies.Here is an Exploratory Data Analysis using data from a FDA Precision Medicine Competition. within the R environment. For this EDA in the main we will use [tidyverse](https://www.tidyverse.org/packages/) and [limma](https://www.tidyverse.org/packages/) packages. 

Our task is to select a panel of classfiers that we can use to build an algorithm that predicts the outcome of the diagnosis.

Goal 1: Predict MSI level
Goal 2: Predict gender

---
# First Step of viewing normalized spectra count protomics data 
## Data loading 

```{r, message=FALSE, warning=FALSE, results='hide'}
data<-read.csv('training1114.csv')
y<-read.csv('y.csv') # Y chromosome proteins
```

### Here we load libraries for data wrangling and visualisation.
```{r, message=FALSE, warning=FALSE, results='hide'}
library(tidyverse)
library(limma)
```

## peak at the dataset
```{r, message=FALSE, warning=FALSE, results='hide'}
dim(data)
glimpse(data)
```
## getting Y chromosome proteins for gender prediction
```{r, message=FALSE, warning=FALSE, results='hide'}
x <- as.character(y$gene)
y$protein <- gsub( "\\s.*", "", x )
yprotein <- intersect(y$protein,names(data)) # Y chromosome protein found in the training set
                         
```

## feature selection with limma using proteins contains no NAs 
### remove columns contain NAs  
```{r, message=FALSE, warning=FALSE, results='hide'}
data_NA <- data[,complete.cases(t(data))] 
data_NA<-cbind(data_NA,data[,yprotein])

# create result and expression matrices 
dmsi<-as.data.frame(ifelse(data_NA$msi=='Lo',0,1))
x1<-t(data_NA[,4:(length(data_NA))])
```
## fit the model
```{r, message=FALSE, warning=FALSE, results='hide'}
msi_lm<-lmFit(x1, dmsi) #robust linear model

### standard errors have been moderated across proteins (shrunk towards a common value using a Bayesian model)
msi_lm<-eBayes(msi_lm)
```
## generates top20 with lowest p value
```{r, message=FALSE, warning=FALSE, results='hide'}
msi_list<-as.data.frame(msi_lm,coefficient=1)
msi_list<-cbind(rownames(msi_list),msi_list)
msi_list<-arrange(msi_list,(p.value))
msi_toplist<-as.character(msi_list[1:20,1]) # top20 with lowest p value
rm(msi_lm)
```
## Check Protein Expression 
### organize table
```{r, message=FALSE, warning=FALSE, results='hide'}
lm_top <-select(data_NA, sample, gender, msi, msi_toplist,yprotein)
data <- gather(data = lm_top, key = Class, value = Abundance, -c(1:3))
table<-summarise(group_by(data, Class, msi, gender), expression=mean(Abundance))

table
```
# box plot 
```{r, message=FALSE, warning=FALSE, results='hide'}
x_lo<-subset(lm_top, lm_top$msi=='Lo')
x_hi<-subset(lm_top, lm_top$msi=='Hi')
xlo_f<-subset(x_lo, x_lo$gender=='f')
xlo_m<-subset(x_lo, x_lo$gender=='m')
xhi_f<-subset(x_hi, x_hi$gender=='f')
xhi_m<-subset(x_hi, x_hi$gender=='m')

par(mfrow=c(2,2))
for (i in 4:23){
   
   boxplot(x_hi[,i],xhi_f[,i],xhi_m[,i],x_lo[,i],xlo_f[,i],xlo_m[,i], 
           col = c('blue', 'red', 'steelblue','orange','cyan4','brown1'), 
           xlab='msi-H f_Hi m_Hi msi-L f_Lo m_Lo', ylab=colnames(x_hi)[i])
}

```